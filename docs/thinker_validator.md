# ThinkerValidator å‘½ä»¤è¡Œä½¿ç”¨æ–‡æ¡£

## ðŸ“Œ ç®€ä»‹

**ThinkerValidator** æ˜¯ä¸€ä¸ªç”¨äºŽéªŒè¯è®­ç»ƒæ¡†æž¶ä¸ŽæŽ¨ç†æ¡†æž¶è¾“å‡ºä¸€è‡´æ€§çš„å·¥å…·æ¨¡å—ã€‚  
è¯¥å·¥å…·åŸºäºŽè®­ç»ƒç«¯çš„ **Linger** å·¥å…·é“¾ä¸ŽæŽ¨ç†ç«¯çš„ **Thinker** æŽ¨ç†å¼•æ“Žï¼Œåœ¨ä¸¤ä¾§åˆ†åˆ«æ‰§è¡ŒæŽ¨ç†ä»»åŠ¡å¹¶å¯¼å‡ºä¸­é—´å¼ é‡ï¼ˆTensorï¼‰çš„ **dump æ–‡ä»¶**ã€‚

é€šè¿‡å¯¹æ¯”ä¸¤ä¾§ç”Ÿæˆçš„ dump æ•°æ®ï¼Œ**ThinkerValidator** èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å¹¶æŠ¥å‘Šè®¡ç®—ç»“æžœä¸Šçš„å·®å¼‚ï¼Œä»Žè€Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½æ¨¡åž‹åœ¨æŽ¨ç†é˜¶æ®µå¯èƒ½å­˜åœ¨çš„ä¸ä¸€è‡´ç®—å­æˆ–èŠ‚ç‚¹ã€‚

æœ¬ç« èŠ‚ä»‹ç» **ThinkerValidator çš„å‘½ä»¤è¡Œï¼ˆCLIï¼‰ä½¿ç”¨æ–¹å¼**ã€‚

---

## âš™ï¸ å®‰è£…ä¸Žä¾èµ–

åœ¨ä½¿ç”¨ **ThinkerValidator CLI** ä¹‹å‰ï¼Œè¯·ç¡®ä¿ç³»ç»Ÿä¸­å·²æ­£ç¡®å®‰è£…ä»¥ä¸‹ç»„ä»¶ï¼š

- **Linger**ï¼šé‡åŒ–è®­ç»ƒå·¥å…·  
- **Thinker**ï¼šæŽ¨ç†å¼•æ“ŽåŠå…¶è¿è¡Œæ—¶åŠ¨æ€åº“ï¼ˆ`libthinker.so`ï¼‰

### âš ï¸ æ³¨æ„

ç”±äºŽ **Linger** ä¸Ž **Thinker** åœ¨éƒ¨åˆ†ä¾èµ–åŒ…ï¼ˆå°¤å…¶æ˜¯ ONNX ç›¸å…³ä¾èµ–ï¼‰ä¸Šå¯èƒ½å­˜åœ¨ç‰ˆæœ¬å†²çªï¼Œ  
åœ¨å°† **Linger** ä¸Ž **Thinker** åˆ†åˆ«å®‰è£…å®ŒæˆåŽï¼Œå»ºè®®æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–° ONNX ä»¥é¿å…çŽ¯å¢ƒå†²çªï¼š

```bash
pip install --upgrade onnx
```
## ðŸ§© å‚æ•°è¯´æ˜Ž
### åŸºæœ¬å‘½ä»¤è¡Œæ ¼å¼
```bash
tvalidator [options]
```
### å‚æ•°åˆ—è¡¨
| å‚æ•°                   | ç±»åž‹          | æ˜¯å¦å¿…éœ€ | è¯´æ˜Ž                                                   |
| -------------------- | ----------- | ---- | ---------------------------------------------------- |
| `-g`, `--onnx_path`  | `str`       | æ˜¯    | ONNX æ¨¡åž‹æ–‡ä»¶è·¯å¾„ï¼Œå¿…é¡»æä¾›                                     |
| `-r`, `--res_path`   | `str`       | å¦    | æ¨¡åž‹èµ„æºæ–‡ä»¶è·¯å¾„ï¼ˆ`.bin`ï¼‰ã€‚å½“éœ€è¦æ‰‹åŠ¨æ‰“åŒ…æ¨¡åž‹æ—¶å¿…é¡»æä¾›                      |
| `-l`, `--lib_path`   | `str`       | å¦    | Thinker æŽ¨ç†å¼•æ“ŽåŠ¨æ€åº“è·¯å¾„ï¼ˆå¦‚ `libthinker.so`ï¼‰ã€‚å½“ä¸åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œæ—¶å¿…é¡»æä¾› |
| `-i`, `--input_path` | `str ...`   | å¦    | ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥æ–‡ä»¶è·¯å¾„ã€‚å½“éœ€è¦æ‰‹åŠ¨æŒ‡å®šè¾“å…¥æ—¶å¿…é¡»æä¾›                           |
| `--cfg`              | `key=value` | å¦    | åŠ¨æ€ shape é…ç½®å‚æ•°                                 |
## ðŸ§© åŠ¨æ€ Shape å‚æ•°è¯´æ˜Žï¼ˆ--cfgï¼‰
valueï¼šä»¥é€—å·åˆ†éš”çš„æ•´æ•°åˆ—è¡¨ï¼Œé€šå¸¸è¡¨ç¤º (min, max, step)
- **key**ï¼šåŠ¨æ€ shape åç§°ã€‚  
- **value**ï¼šä»¥é€—å·åˆ†éš”çš„æ•´æ•°åˆ—è¡¨ï¼Œé€šå¸¸è¡¨ç¤º (min, max, step)ã€‚ 
### ç¤ºä¾‹
```bash
--cfg seq_len=32:384:32
```
## ðŸš€ ä½¿ç”¨ç¤ºä¾‹
### 1ï¸âƒ£ æ¨¡åž‹ä¸éœ€è¦æ‰‹åŠ¨æ‰“åŒ…ï¼Œä»…æä¾›ONNX
```bash
tvalidator \
  -g model/track_id/arcs_trackid20250919.onnx \
  -l bin/libthinker.so
```
### 2ï¸âƒ£ æ¨¡åž‹éœ€è¦æ‰‹åŠ¨æ‰“åŒ…ï¼ŒåŒæ—¶æä¾›ONNXå’Œæ‰“åŒ…åŽçš„èµ„æº
```bash
tvalidator \
  -g model/track_id/arcs_trackid20250919.onnx \
  -r model/track_id/arcs_trackid20250919.bin \
  -l bin/libthinker.so
```
### 3ï¸âƒ£ ä½¿ç”¨è‡ªå®šä¹‰çš„è¾“å…¥éªŒè¯ä¸€è‡´æ€§
```bash
tvalidator \
  -g model/track_id/arcs_trackid20250919.onnx \
  -r model/track_id/arcs_trackid20250919.bin \
  -l bin/libthinker.so \
  -i input_0.npy input_1.npy
```
### 4ï¸âƒ£ éªŒè¯åŠ¨æ€shapeå›¾
```bash
tvalidator \
  -g model/track_id/arcs_trackid20250919.onnx \
  -r model/track_id/arcs_trackid20250919.bin \
  -l bin/libthinker.so \
  --cfg seq_len=32:384:32,yinsu_len=1:80:1
```
## ðŸ§ª è¾“å‡ºç»“æžœè¯´æ˜Ž
åœ¨æ‰§è¡Œä¸€è‡´æ€§éªŒè¯åŽï¼Œ**ThinkerValidator** ä¼šæ ¹æ®æ¯”å¯¹ç»“æžœè¾“å‡ºä¸¤ç§çŠ¶æ€ä¿¡æ¯ï¼š

---

### âœ… ä¸€è‡´æ€§éªŒè¯é€šè¿‡
å½“æ‰€æœ‰ä¸­é—´ Tensor çš„å†…å®¹å®Œå…¨ä¸€è‡´æ—¶ï¼Œç³»ç»Ÿå°†è¾“å‡ºå¦‚ä¸‹æç¤ºä¿¡æ¯ï¼š
```bash
âœ” Consistency verification passed!
```
è¡¨ç¤ºè®­ç»ƒæ¡†æž¶ä¸ŽæŽ¨ç†æ¡†æž¶çš„è®¡ç®—ç»“æžœå®Œå…¨å¯¹é½ï¼Œæ— éœ€è¿›ä¸€æ­¥æŽ’æŸ¥ã€‚
### âŒ ä¸€è‡´æ€§éªŒè¯æœªé€šè¿‡

è‹¥æ£€æµ‹åˆ°ä»»æ„ Tensor æ–‡ä»¶å­˜åœ¨å·®å¼‚ï¼Œç³»ç»Ÿå°†è¾“å‡ºå¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œå¹¶è‡ªåŠ¨æ‰“å¼€vscodeçš„compareåŠŸèƒ½ï¼ˆå¦‚æžœåœ¨vscodeçŽ¯å¢ƒä¸‹ï¼‰ï¼ŒååŠ©å®šä½ç¬¬ä¸€ä¸ªå‡ºé”™çš„ä½ç½®ï¼š
```
-> [!] First mismatch tensor: 142
  -> Shape: (1, 8, 64, 64)

    -> Showing first 16 mismatched entries:
    -----------------------------------------------------------------
    |     Index      |   Linger (training)   |  Thinker (inference) |
    -----------------------------------------------------------------
    | (0, 0, 0, 0)   |         16            |          0           |
    | (0, 0, 0, 1)   |          2            |         26           |
    | (0, 0, 0, 2)   |          0            |         12           |
    | (0, 0, 0, 3)   |         12            |          0           |
    | (0, 0, 0, 4)   |         34            |          0           |
    | (0, 0, 0, 5)   |         21            |         17           |
    | (0, 0, 0, 6)   |         11            |          8           |
    | (0, 0, 0, 7)   |          0            |         40           |
    | (0, 0, 0, 8)   |         13            |          7           |
    | (0, 0, 0, 11)  |         12            |         24           |
    | (0, 0, 0, 12)  |         17            |          7           |
    | (0, 0, 0, 13)  |         17            |          0           |
    | (0, 0, 0, 14)  |          0            |         12           |
    | (0, 0, 0, 15)  |          3            |          0           |
    | (0, 0, 0, 16)  |          0            |         38           |
    | (0, 0, 0, 17)  |         24            |          0           |
    -----------------------------------------------------------------
  -> Launching VSCode compare for the following files: 
      -> Linger : data/onnxrunner_int/142##_int_dump.txt
      -> Thinker: data/142##_1_8_64_64.txt
```